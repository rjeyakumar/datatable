<table class="table table-cxo">
  <thead>
    <tr>
      <th ng-if="orderBook.type === 'fixed'">#</th>
      <th ng-repeat="headerCol in orderBook.columns" colspan="{{headerCol.subColumns ?  headerCol.subColumns.length : 0}}" rowspan="{{headerCol.subColumns ? 1 : 2}}">{{headerCol.name}}</th>
    </tr>
    <tr ng-if="orderBook.subColumns.length > 0">
      <th ng-if="orderBook.type === 'fixed'"></th>
      <th ng-data="{{subHeaderCol}}" ng-repeat="subHeaderCol in orderBook.subColumns">{{subHeaderCol.name}}</th>
    </tr>
  </thead>
  <tbody ng-if="orderBook.type !== 'fixed' && (!orderBook.data || orderBook.data.mainAccList.length === 0)">
    <tr>
      <td>No results found</td>
    </tr>
  </tbody>
  <tbody ng-if="orderBook.data && orderBook.data.mainAccList.length > 0">
    <tr class="table-crm-grand-bg">
      <td ng-if="orderBook.type === 'fixed'"></td>
      <td ng-if="col.key" ng-repeat="col in orderBook.rows track by $index">
        {{orderBook.data.grandTotal[col.key]}}
      </td>
    </tr>
    <tr class="table-crm-bg" ng-if="account" ng-repeat-start="account in orderBook.data.mainAccList track by $index">
      <td ng-if="orderBook.type === 'fixed'">{{$index + 1}}</td>
      <td ng-if="col.key" ng-repeat="col in orderBook.rows track by $index">
        {{account.account[col.key]}}
      </td>
    </tr>
    <tr ng-if="!orderBook.noAgreement && agreement" ng-repeat="agreement in account.agreement track by $index">
      <td ng-if="orderBook.type === 'fixed'"></td>
      <td ng-if="col.key" ng-repeat="col in orderBook.rows track by $index">
        <span>{{agreement[col.key]}}</span>
      </td>
    </tr>
    <tr ng-if="oppty" ng-repeat="oppty in account.oppty track by $index">
      <td ng-if="orderBook.type === 'fixed'"></td>
      <td ng-if="col.key" ng-class="{red: col.name == 'Agreement Name'}" ng-repeat="col in orderBook.rows">
        {{oppty[col.key]}}
      </td>
    </tr>
    <tr ng-if="!orderBook.noAgreement && upside" ng-repeat="upside in account.upside track by $index">
      <td ng-if="orderBook.type === 'fixed'"></td>
      <td ng-repeat-start="col in orderBook.rows" ng-if="col.key === 'accountName'">
        <a class="glyphicon glyphicon-remove" ng-click="orderBook.deleteHandler($parent.$parent.$parent.$parent.$index, $parent.$parent.$parent.$index, 'upside')"></a>
      </td>
      <td ng-if="col.key && col.key !== 'accountName'" ng-repeat-end>
        <div ng-switch="col.key">
          <select ng-switch-when="agreementCategory" ng-model="upside[col.key].value">
            <option ng-repeat="category in upside[col.key].data" value="{{category.value}}">{{category.label}}</option>
          </select>
          <div ng-switch-default value="upside[col.key]" key="col.key" editable="false" category="upside['agreementCategory'].value"></div>
        </div>
      </td>
    </tr>
    <tr ng-if="!orderBook.noAgreement && newRow" ng-repeat="newRow in account.newRows track by $index">
      <td ng-if="orderBook.type === 'fixed'"></td>
      <td ng-repeat-start="col in orderBook.rows" ng-if="col.key === 'accountName'">
        <a class="glyphicon glyphicon-remove" ng-click="orderBook.deleteHandler($parent.$parent.$parent.$parent.$index, $parent.$parent.$parent.$index, 'newRows')"></a>
      </td>
      <td ng-if="col.key && col.key !== 'accountName'" ng-repeat-end>
        <div ng-switch="col.key">
          <select ng-switch-when="agreementCategory" ng-model="newRow[col.key].value">
            <option ng-repeat="category in newRow[col.key].data" value="{{category.value}}">{{category.label}}</option>
          </select>
          <div ng-switch-default value="newRow[col.key]" key="col.key" editable="true" category="newRow['agreementCategory'].value"></div>
        </div>
      </td>
    </tr>
    <tr ng-repeat-end ng-if="!orderBook.noAgreement">
      <td ng-if="orderBook.type === 'fixed'"></td>
      <td ng-if="col.key" ng-repeat="col in orderBook.rows track by $index">
        <a ng-if="col.key === 'accountName'" class="glyphicon glyphicon-plus-sign" ng-click="orderBook.filterHandler({index: $parent.$parent.$parent.$index})">Add Row</a>
      </td>
    </tr>
  </tbody>
</table>